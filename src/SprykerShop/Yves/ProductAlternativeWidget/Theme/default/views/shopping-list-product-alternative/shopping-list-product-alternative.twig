{% extends template('widget') %}

{% define data = {
    item: _widget.item,
    shoppingList: _widget.shoppingList,
    products: _widget.products
} %}

{% set idShoppingListItem = data.item.idShoppingListItem %}

{% block body %}
    {% if data.products is not empty %}
        <tr>
            <td colspan="2"></td>
            <td colspan="5">
                <table class="table table--expand" {{qa('submit-button')}}>
                {% for item in data.products %}
                    {% if loop.index == 4 %}
                        <tr class="js-product-alternative-{{- idShoppingListItem -}}__show-all-container">
                            <td class="text-center" colspan="5">
                                <span class="js-product-alternative-{{- idShoppingListItem -}}__show-all-trigger">{{ 'Show all' }}</span>
                            </td>
                        </tr>
                        {% include molecule('toggler-click') with {
                            attributes: {
                                'trigger-selector': '.js-product-alternative-' ~ idShoppingListItem ~ '__show-all-trigger',
                                'target-selector': '.js-product-alternative-' ~ idShoppingListItem ~ '__show-all-target',
                                'class-to-toggle': 'is-hidden'
                            }
                        } only %}
                        {% include molecule('toggler-click') with {
                            attributes: {
                                'trigger-selector': '.js-product-alternative-' ~ idShoppingListItem ~ '__show-all-trigger',
                                'target-selector': '.js-product-alternative-' ~ idShoppingListItem ~ '__show-all-container',
                                'class-to-toggle': 'is-hidden'
                            }
                        } only %}
                    {% endif %}
                    <tr class="{{ loop.index > 3 ? 'js-product-alternative-' ~ idShoppingListItem ~ '__show-all-target is-hidden' : '' }}">
                        <td class="text-center">
                            {% if item.images is defined and item.images is not empty %}
                                {% include atom('thumbnail') with {
                                    modifiers: ['small', 'min-size'],
                                    attributes: {
                                        alt: item.name,
                                        src: item.images.0.externalUrlSmall,
                                        title: item.name
                                    }
                                } only %}
                            {% endif %}
                        </td>
                        <td class="text-center">
                            <a href="{{ item.url }}">{{ item.name }}</a>
                            <div><small>{{ item.sku }}</small></div>
                            {% for attribute in item.superAttributesDefinition %}
                                {% if item.attributes[attribute] is defined %}
                                    {{ ('product.attribute.'~attribute) | trans }}: {{ item.attributes[attribute] }} <br/>
                                {% endif %}
                            {% endfor %}
                            <span>{{ 'product_alternative_widget.alternative_for' | trans({name: data.item.name}) }}</span>
                        </td>
                        <td class="text-center">
                            {% if item.price is not null %}
                                {% include molecule('price') with {
                                    data: {
                                        amount: item.price | money,
                                        originalAmount: item.prices.ORIGINAL is not defined or item.prices.ORIGINAL is empty ? null : (item.prices.ORIGINAL | money)
                                    }
                                } only %}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                        <td>
                            <input class="input" disabled type="number" value="{{ data.item.quantity }}"/>
                        </td>
                        <td>
                            <a class="button button--success" href="{{ url('shopping-list/add-item', {quantity: data.item.quantity, sku: item.sku, idShoppingList: data.shoppingList.idShoppingList}) }}">
                                {{ 'product_alternative_widget.add_to_shopping_list' | trans}}
                            </a>
                        </td>
                    </tr>
                {% endfor %}
                </table>
            </td>
        </tr>
    {% endif %}
{% endblock %}
