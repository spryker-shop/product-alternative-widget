{% extends model('component') %}

{% define config = {
    name: 'alternative-products-table',
    tag: 'table'
} %}

{% define data = {
    item: required,
    shoppingList: required,
    products: required
} %}

{% set idShoppingListItem = data.item.idShoppingListItem %}

{% block body %}
    {% for item in data.products %}
        <tr class="{{ config.name }}__row {{ loop.index > 3 ? 'js-product-alternative-' ~ idShoppingListItem ~ '__show-all-target is-hidden' : '' }}">
            <td class="text-center">
                {% if item.images is defined and item.images is not empty %}
                    {% include atom('thumbnail') with {
                        modifiers: ['small', 'min-size'],
                        attributes: {
                            alt: item.name,
                            src: item.images.0.externalUrlSmall,
                            title: item.name
                        }
                    } only %}
                {% endif %}
            </td>
            <td class="text-center">
                <a href="{{ item.url }}">{{ item.name }}</a><br />
                <small class="text-secondary">{{ item.sku }}</small><br />
                {% for attribute in item.superAttributesDefinition %}
                    {% if item.attributes[attribute] is defined %}
                        <strong>{{ ('product.attribute.'~attribute) | trans }}</strong>: {{ item.attributes[attribute] }} <br/>
                    {% endif %}
                {% endfor %}
                <span class="text-alert">{{ 'product_alternative_widget.alternative_for' | trans({name: data.item.name}) }}</span>
            </td>
            <td class="text-center">
                {% if item.price is not null %}
                    {% include molecule('price') with {
                        data: {
                            amount: item.price | money,
                            originalAmount: item.prices.ORIGINAL is not defined or item.prices.ORIGINAL is empty ? null : (item.prices.ORIGINAL | money)
                        }
                    } only %}
                {% else %}
                    N/A
                {% endif %}
            </td>
            <td>
                <input class="input" disabled type="number" value="{{ data.item.quantity }}"/>
            </td>
            <td>
                <a class="button button--success" href="{{ url('shopping-list/add-item', {quantity: data.item.quantity, sku: item.sku, idShoppingList: data.shoppingList.idShoppingList}) }}">
                    {{ 'product_alternative_widget.add_to_shopping_list' | trans}}
                </a>
            </td>
        </tr>
        {% if loop.index > 3 and loop.last %}
            <tr class="js-product-alternative-{{- idShoppingListItem -}}__show-all-target">
                <td colspan="5">
                    <div class="text-center spacing-y">
                        <span class="button button--hollow js-product-alternative-{{- idShoppingListItem -}}__show-all-trigger">{{ 'product_alternative_widget.show_all' | trans }}</span>
                    </div>
                </td>
            </tr>
            {% include molecule('toggler-click') with {
                attributes: {
                    'trigger-selector': '.js-product-alternative-' ~ idShoppingListItem ~ '__show-all-trigger',
                    'target-selector': '.js-product-alternative-' ~ idShoppingListItem ~ '__show-all-target',
                    'class-to-toggle': 'is-hidden'
                }
            } only %}
        {% endif %}
    {% endfor %}
{% endblock %}
